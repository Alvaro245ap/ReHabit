<!doctype html>
<html lang="en" data-lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ReHabit â€” Your Recovery Companion</title>
  <meta name="theme-color" content="#1f3a8a" />
  <link rel="icon" href="assets/favicon.png">
  <link rel="manifest" href="manifest.webmanifest">

  <!-- Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Francois+One&family=Inter:wght@400;600;700&display=swap" rel="stylesheet">

  <link rel="stylesheet" href="styles.css" />

  <!-- Small helpers for pill titles + minor layout you requested -->
  <style>
    /* pill titles and small helpers (only whatâ€™s needed) */
    .page-title{display:flex;justify-content:center;margin:.25rem 0 1rem}
    .title-pill{
      display:inline-block;padding:.4rem .9rem;border-radius:999px;
      background:var(--primary-2);color:#fff;font-weight:800;
      font-family:"Francois One", Inter, system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Arial, "Noto Sans";
      letter-spacing:.2px
    }
    .block-title{display:flex;justify-content:center;margin:.25rem 0 1rem}
    .streak-label{font-weight:800;display:flex;gap:.4rem;align-items:center;justify-content:center}
    /* narrower drawer per your earlier ask still works with existing CSS */
    .drawer{max-width:75vw}
    /* center the two Home cards and keep L/R order */
    #view-home .grid-2{align-items:start}
    /* remove ALL blue R logos (none included in HTML now) */
  </style>

  <!-- (Optional) Firebase libs kept for future use -->
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore-compat.js"></script>
  <script>
    const firebaseConfig = { apiKey:"YOUR_API_KEY", authDomain:"YOUR_PROJECT.firebaseapp.com", projectId:"YOUR_PROJECT_ID", appId:"YOUR_APP_ID" };
    try { firebase.initializeApp(firebaseConfig); } catch(e) {}
  </script>
</head>
<body>
  <header class="app-header">
    <button id="menuBtn" class="hamburger" aria-label="Menu" aria-haspopup="true" aria-controls="drawer">â˜°</button>

    <div class="brand">
      <!-- (removed any blue R logos) -->
      <div class="slogans-inline">
        <span class="chip primary">ReBuild â€¢ ReWire â€¢ ReHabit</span>
      </div>
    </div>

    <div class="header-actions">
      <select id="langSelect" aria-label="Language">
        <option value="en">English</option>
        <option value="es">EspaÃ±ol</option>
      </select>
      <button id="installBtn" class="btn subtle" aria-label="Install" hidden data-i18n="install">Install</button>
    </div>
  </header>

  <!-- Drawer menu (includes Home + Badges) -->
  <aside id="drawer" class="drawer" aria-hidden="true">
    <div class="drawer-head">
      <strong class="fancy">Menu</strong>
      <button id="closeDrawer" class="btn subtle" aria-label="Close">Ã—</button>
    </div>
    <nav class="drawer-nav">
      <button class="drawer-link" data-nav="home">
        <svg viewBox="0 0 24 24"><path d="M3 10.5 12 3l9 7.5V21a1 1 0 0 1-1 1h-5v-7H9v7H4a1 1 0 0 1-1-1v-10.5z" fill="currentColor"/></svg>
        <span data-i18n="home">Home</span>
      </button>
      <button class="drawer-link" data-nav="checkin" data-i18n="checkin">
        <svg viewBox="0 0 24 24"><path d="M5 4h14a1 1 0 0 1 1 1v14l-4-3H5a1 1 0 0 1-1-1V5a1 1 0 0 1 1-1z" fill="currentColor"/></svg>
        <span>Daily Check-in</span>
      </button>
      <button class="drawer-link" data-nav="calendar" data-i18n="calendar">
        <svg viewBox="0 0 24 24"><path d="M6 2h2v3h8V2h2v3h3v17H3V5h3V2z" fill="currentColor"/></svg>
        <span>Calendar</span>
      </button>
      <button class="drawer-link" data-nav="guide" data-i18n="guide">
        <svg viewBox="0 0 24 24"><path d="M4 3h16v18H4zM8 7h8M8 12h8M8 17h8" fill="currentColor"/></svg>
        <span>Guide</span>
      </button>
      <button class="drawer-link" data-nav="badges" data-i18n="badges">
        <svg viewBox="0 0 24 24"><path d="M12 2l3 6 6 .9-4.5 4.3 1 6-5.5-3-5.5 3 1-6L3 8.9 9 8z" fill="currentColor"/></svg>
        <span>Badges</span>
      </button>
      <button class="drawer-link" data-nav="research" data-i18n="research">
        <svg viewBox="0 0 24 24"><path d="M12 2a7 7 0 0 1 7 7c0 4.5-7 13-7 13S5 13.5 5 9a7 7 0 0 1 7-7zm0 9.5a2.5 2.5 0 1 0 0-5 2.5 2.5 0 0 0 0 5z" fill="currentColor"/></svg>
        <span>Research</span>
      </button>
      <button class="drawer-link" data-nav="notes" data-i18n="notes">
        <svg viewBox="0 0 24 24"><path d="M6 2h9l5 5v15a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2zM14 2v5h5" fill="currentColor"/></svg>
        <span>Notes</span>
      </button>
      <button class="drawer-link" data-nav="friends" data-i18n="friends">
        <svg viewBox="0 0 24 24"><path d="M12 12a4 4 0 1 0-4-4 4 4 0 0 0 4 4zm0 2c-3.33 0-10 1.67-10 5v3h20v-3c0-3.33-6.67-5-10-5z" fill="currentColor"/></svg>
        <span>Friends</span>
      </button>
      <button class="drawer-link" data-nav="settings" data-i18n="settings">
        <svg viewBox="0 0 24 24"><path d="M12 8a4 4 0 1 1 0 8 4 4 0 0 1 0-8zm8.94 3a8.1 8.1 0 0 1 0 2l2.06 1.6-2 3.46-2.45-1a8.2 8.2 0 0 1-1.74 1l-.37 2.6H7.56l-.37-2.6a8.2 8.2 0 0 1-1.74-1l-2.45 1-2-3.46L3.06 13a8.1 8.1 0 0 1 0-2L1 9.4l2-3.46 2.45 1a8.2 8.2 0 0 1 1.74-1L7.56 3h4.88l.37 2.6a8.2 8.2 0 0 1 1.74 1l2.45-1 2 3.46L20.94 11z" fill="currentColor"/></svg>
        <span>Settings</span>
      </button>
      <button class="drawer-link danger" data-nav="sos" data-i18n="emergency">
        <svg viewBox="0 0 24 24"><path d="M1 21h22L12 2 1 21zm12-3h-2v-2h2v2zm0-4h-2v-4h2v4z" fill="currentColor"/></svg>
        <span>Emergency</span>
      </button>
    </nav>
  </aside>
  <div id="backdrop" class="backdrop" hidden></div>

  <!-- Crisis pill -->
  <aside class="crisis-mini" role="note" aria-label="Crisis support">
    <a href="https://www.iasp.info/crisis-centres-helplines/" target="_blank" rel="noopener" data-i18n="danger">If in danger, get help</a>
  </aside>

  <main id="app" class="container">

    <!-- Onboarding -->
    <section id="view-onboarding" class="card">
      <div class="page-title"><span class="title-pill" data-i18n="welcome">Welcome ðŸ‘‹</span></div>
      <p data-i18n="selectFocus">Select your focus and a target date to start tracking progress.</p>

      <div class="addiction-grid" style="margin-bottom:12px">
        <label class="addiction-card">
          <input type="checkbox" name="focus" value="Technology">
          <img src="assets/tech.png" alt="Technology">
          <span data-i18n="a_tech">Technology</span>
        </label>
        <label class="addiction-card">
          <input type="checkbox" name="focus" value="Smoking">
          <img src="assets/smoking.png" alt="Smoking">
          <span data-i18n="a_smoke">Smoking</span>
        </label>
        <label class="addiction-card">
          <input type="checkbox" name="focus" value="Alcohol">
          <img src="assets/alcohol.png" alt="Alcohol">
          <span data-i18n="a_alcohol">Alcohol</span>
        </label>
        <label class="addiction-card">
          <input type="checkbox" name="focus" value="Gambling">
          <img src="assets/gambling.png" alt="Gambling">
          <span data-i18n="a_gambling">Gambling</span>
        </label>
        <label class="addiction-card">
          <input type="checkbox" name="focus" value="Other">
          <img src="assets/other.png" alt="Other drugs">
          <span data-i18n="a_other">Other drugs</span>
        </label>
      </div>

      <form id="onboardingForm" class="grid" action="javascript:void(0)">
        <label><span data-i18n="quitDate">Quit/target date</span><input type="date" name="quitDate" required></label>
        <label><span data-i18n="motivation">Your main motivation (optional)</span><input type="text" name="motivation" maxlength="120" placeholder="e.g., Be healthier for my family" /></label>
        <button class="btn primary" type="submit" data-i18n="start">Start ReHabit</button>
      </form>
    </section>

    <!-- Home -->
    <section id="view-home" class="card" hidden>
      <div class="grid-2">
        <!-- Left: Calendar -->
        <div class="card soft">
          <div class="block-title"><span class="title-pill" data-i18n="monthCard">Calendar (this month)</span></div>
          <div class="calendar-head">
            <div id="monthLabel"></div>
            <div id="streakLabel" class="streak-label"></div>
          </div>
          <div id="calendarGrid" class="calendar"></div>
          <p class="muted" data-i18n="calendarHelp">Click a day to toggle: blank â†’ Success â†’ Slip.</p>
        </div>

        <!-- Right: 10 Steps -->
        <div class="card soft">
          <div class="block-title"><span class="title-pill" data-i18n="steps">10 Steps</span></div>
          <div id="homeStepsChoiceWrap" hidden style="display:flex;justify-content:center;margin-bottom:.5rem">
            <label>
              <span data-i18n="chooseAddiction">Choose addiction</span>
              <select id="homeStepsChoice"></select>
            </label>
          </div>
          <ol id="homeStepsList" class="program"></ol>
        </div>
      </div>
    </section>

    <!-- Calendar (full) -->
    <section id="view-calendar" class="card" hidden>
      <div class="page-title"><span class="title-pill" data-i18n="calendar">Calendar</span></div>
      <div class="calendar-head">
        <div id="monthLabel2"></div>
        <div id="streakLabel2" class="streak-label"></div>
      </div>
      <div id="calendarGrid2" class="calendar"></div>
      <div class="actions low">
        <button class="btn subtle" data-nav="home" data-i18n="back">Back</button>
      </div>
    </section>

    <!-- Check-in -->
    <section id="view-checkin" class="card" hidden>
      <div class="page-title"><span class="title-pill" data-i18n="checkin">Daily Check-in</span></div>
      <div class="grid-2">
        <div class="card soft">
          <p id="encouragement" class="encouragement big"></p>

          <form id="checkinForm" class="grid pro-form" action="javascript:void(0)">
            <div class="grid-2">
              <label><span data-i18n="mood">Mood (0â€“10)</span>
                <input type="range" name="mood" min="0" max="10" value="5" oninput="moodVal.textContent=this.value">
                <small><span data-i18n="value">Value:</span> <span id="moodVal">5</span></small>
              </label>
              <label><span data-i18n="urge">Urge (0â€“10)</span>
                <input type="range" name="urge" min="0" max="10" value="3" oninput="urgeVal.textContent=this.value">
                <small><span data-i18n="value">Value:</span> <span id="urgeVal">3</span></small>
              </label>
            </div>

            <div class="grid-2">
              <label><span data-i18n="sleep">Hours of sleep</span><input type="number" name="sleep" min="0" max="24" value="7"></label>
              <label><span data-i18n="cravingWindow">Craving window</span>
                <select name="window">
                  <option value="morning" data-i18n="morning">Morning</option>
                  <option value="afternoon" data-i18n="afternoon">Afternoon</option>
                  <option value="evening" data-i18n="evening">Evening</option>
                  <option value="night" data-i18n="night">Night</option>
                </select>
              </label>
            </div>

            <label><span data-i18n="actionTook">Helpful action you took</span><input type="text" name="action" maxlength="120" placeholder="Walk, water, texted a friend..."></label>
            <label><span data-i18n="note">Note (optional)</span><textarea name="note" rows="3" placeholder=""></textarea></label>

            <fieldset class="radios">
              <legend class="fancy" data-i18n="exposure">Exposure level today</legend>
              <label><input type="radio" name="exposure" value="low" checked> <span data-i18n="low">Low</span></label>
              <label><input type="radio" name="exposure" value="medium"> <span data-i18n="medium">Medium</span></label>
              <label><input type="radio" name="exposure" value="high"> <span data-i18n="high">High</span></label>
            </fieldset>

            <div class="actions">
              <button class="btn primary" type="submit" data-i18n="save">Save check-in</button>
              <button class="btn subtle" data-nav="home" type="button" data-i18n="back">Back</button>
            </div>
          </form>
        </div>

        <div class="card soft">
          <h3 class="fancy" data-i18n="todayShortcuts">Todayâ€™s shortcuts</h3>
          <div class="actions pro-actions">
            <button class="btn success" id="markTodayOk2" data-i18n="markSuccess">Record success today</button>
            <button class="btn danger" id="markTodaySlip2" data-i18n="markSlip">Record slip today</button>
          </div>
          <h3 class="fancy" data-i18n="recent">Recent notes</h3>
          <ul id="recentNotes" class="list"></ul>
        </div>
      </div>
    </section>

    <!-- SOS -->
    <section id="view-sos" class="card sos" hidden>
      <div class="page-title"><span class="title-pill">ðŸš¨ <span data-i18n="sos">Craving SOS</span></span></div>
      <ol class="sos-steps">
        <li data-i18n="s1"><strong>Delay 5 minutes.</strong> Start timer and breathe slowly.</li>
        <li data-i18n="s2"><strong>Urge surfing.</strong> Notice the urge rising and falling.</li>
        <li data-i18n="s3"><strong>Do one alternative action.</strong> Walk, shower, text a friend, drink water.</li>
      </ol>
      <div class="grid-2">
        <div class="card soft">
          <h3 data-i18n="timer">Breathing Timer (1:00)</h3>
          <div id="timer" aria-live="polite">01:00</div>
          <div class="actions"><button class="btn" id="startTimer" data-i18n="startBtn">Start</button><button class="btn subtle" id="resetTimer" data-i18n="reset">Reset</button></div>
        </div>
        <div class="card soft">
          <h3 data-i18n="quickNotes">Quick Notes</h3>
          <textarea id="sosNote" rows="3" placeholder=""></textarea>
          <div class="actions"><button class="btn" id="saveSos" data-i18n="save">Save</button></div>
        </div>
      </div>
      <div class="resources"><h3 data-i18n="helpful">Helpful actions</h3><div class="chips" id="copingChips"></div></div>
      <div class="actions"><button class="btn subtle" data-nav="home" data-i18n="back">Back</button></div>
    </section>

    <!-- Guide -->
    <section id="view-guide" class="card" hidden>
      <div class="page-title"><span class="title-pill" id="guideTitle">Guide</span></div>
      <div id="guideChoiceWrap" class="guide-choice" hidden>
        <label>
          <span data-i18n="chooseAddiction">Choose addiction</span>
          <select id="guideChoice"></select>
        </label>
      </div>

      <div class="guide-tabs">
        <button class="btn tab" data-tab="tips" data-i18n="tips">Tips</button>
        <button class="btn tab" data-tab="steps" data-i18n="steps">10 Steps</button>
        <button class="btn tab" data-tab="deep" data-i18n="deep">Deep Guide</button>
      </div>
      <div id="tab-tips" class="tabpane"></div>
      <ol id="tab-steps" class="tabpane program" hidden></ol>
      <div id="tab-deep" class="tabpane" hidden></div>

      <div class="actions">
        <button class="btn" data-nav="program" data-i18n="materials">Helpful materials</button>
        <button class="btn subtle" data-nav="home" data-i18n="back">Back</button>
      </div>
    </section>

    <!-- Materials -->
    <section id="view-program" class="card" hidden>
      <div class="page-title"><span class="title-pill" id="programTitle">Helpful materials</span></div>
      <ul id="materialsList" class="list bullets"></ul>
      <div id="contribWrap" class="contrib" hidden>
        <h3 data-i18n="contribTitle">Contribute tips (1-year badge required)</h3>
        <form id="contribForm" class="grid" action="javascript:void(0)">
          <label data-i18n="yourTip">Your tip or resource<textarea name="tip" rows="3" maxlength="500"></textarea></label>
          <button class="btn" data-i18n="submit">Submit tip</button>
        </form>
        <p class="muted" data-i18n="contribNote">Contributions may appear for your addiction.</p>
      </div>
      <div class="actions"><button class="btn subtle" data-nav="guide" data-i18n="back">Back</button></div>
    </section>

    <!-- Badges -->
    <section id="view-badges" class="card" hidden>
      <div class="page-title"><span class="title-pill" data-i18n="badges">Badges</span></div>

      <h3 class="fancy" data-i18n="sobriety">Sobriety badges</h3>
      <div id="sobrietyGrid" class="badge-grid"></div>

      <h3 class="fancy" data-i18n="social">Social badges</h3>
      <div id="socialGrid" class="badge-grid"></div>

      <h3 class="fancy" data-i18n="currentTitle">Your current chat title</h3>
      <p id="currentTitle" class="muted">â€”</p>

      <div class="actions"><button class="btn subtle" data-nav="home" data-i18n="back">Back</button></div>
    </section>

    <!-- Research -->
    <section id="view-research" class="card" hidden>
      <div class="page-title"><span class="title-pill" data-i18n="research">Research</span></div>

      <div id="researchChoiceWrap" class="guide-choice" hidden>
        <label>
          <span data-i18n="chooseAddiction">Choose addiction</span>
          <select id="researchChoice"></select>
        </label>
      </div>

      <div id="researchBody"></div>
      <div class="actions"><button class="btn subtle" data-nav="home" data-i18n="back">Back</button></div>
    </section>

    <!-- Community -->
    <section id="view-community" class="card" hidden>
      <div class="page-title"><span class="title-pill" data-i18n="chat">Community chat</span></div>
      <p class="muted" data-i18n="chatNote">Community chat: unmoderated peer support. Click a name (including bots) to send a friend request.</p>

      <div id="globalChat" class="chat-box"></div>
      <form id="globalForm" class="grid" style="grid-template-columns:1fr auto;" action="javascript:void(0)">
        <input type="text" name="msg" placeholder="Write a messageâ€¦" maxlength="300">
        <button class="btn" data-i18n="send">Send</button>
      </form>
      <div class="actions">
        <button class="btn" data-nav="friends" data-i18n="friends">Friends</button>
        <button class="btn subtle" data-nav="home" data-i18n="back">Back</button>
      </div>
    </section>

    <!-- Friends -->
    <section id="view-friends" class="card" hidden>
      <div class="page-title"><span class="title-pill" data-i18n="friends">Friends</span></div>
      <p><span data-i18n="yourCode">Your code:</span> <code id="myUid">â€”</code></p>

      <form id="addFriendForm" class="grid" style="grid-template-columns:1fr auto; margin:8px 0;" action="javascript:void(0)">
        <input type="text" name="code" placeholder="Enter friend code (e.g., RH-COACH)" maxlength="40" />
        <button class="btn" type="submit" data-i18n="send">Send</button>
      </form>
      <p class="muted" id="friendCodeHint">Try codes: RH-COACH, RH-CALM, RH-PEER.</p>

      <h3 class="fancy" data-i18n="requests">Requests</h3>
      <ul id="requestsList" class="list"></ul>
      <h3 class="fancy" data-i18n="friendsList">Friends</h3>
      <ul id="friendList" class="list"></ul>
      <div class="actions"><button class="btn subtle" data-nav="community" data-i18n="back">Back</button></div>
    </section>

    <!-- Settings -->
    <section id="view-settings" class="card" hidden>
      <div class="page-title"><span class="title-pill" data-i18n="settings">Settings</span></div>
      <form id="settingsForm" class="grid" action="javascript:void(0)">
        <label><span data-i18n="displayName">Display name</span>
          <input type="text" name="displayName" maxlength="40" placeholder="Your name">
        </label>

        <fieldset class="grid settings-addictions">
          <legend class="fancy" data-i18n="chooseAddictions">Choose addictions</legend>

          <label class="sa-item">
            <span data-i18n="a_smoke">Smoking</span>
            <input type="checkbox" name="addictions" value="Smoking">
            <img src="assets/smoking.png" alt="Smoking">
          </label>

          <label class="sa-item">
            <span data-i18n="a_alcohol">Alcohol</span>
            <input type="checkbox" name="addictions" value="Alcohol">
            <img src="assets/alcohol.png" alt="Alcohol">
          </label>

          <label class="sa-item">
            <span data-i18n="a_tech">Technology</span>
            <input type="checkbox" name="addictions" value="Technology">
            <img src="assets/tech.png" alt="Technology">
          </label>

          <label class="sa-item">
            <span data-i18n="a_gambling">Gambling</span>
            <input type="checkbox" name="addictions" value="Gambling">
            <img src="assets/gambling.png" alt="Gambling">
          </label>

          <label class="sa-item">
            <span data-i18n="a_other">Other drugs</span>
            <input type="checkbox" name="addictions" value="Other">
            <img src="assets/other.png" alt="Other drugs">
          </label>
        </fieldset>

        <div class="actions">
          <button class="btn primary" data-i18n="save">Save</button>
          <button class="btn subtle" type="button" data-nav="home" data-i18n="back">Back</button>
        </div>
      </form>
    </section>

    <!-- Notes -->
    <section id="view-notes" class="card" hidden>
      <div class="page-title"><span class="title-pill" data-i18n="notes">Notes</span></div>
      <p class="muted" data-i18n="notesInfo">Your Daily and SOS notes appear here (newest first).</p>
      <ul id="notesList" class="list"></ul>
      <div class="actions"><button class="btn subtle" data-nav="home" data-i18n="back">Back</button></div>
    </section>

  </main>

  <!-- Bottom tabs (unchanged, no badges here) -->
  <nav class="tabbar" aria-label="Primary">
    <button data-nav="home" class="tabbtn"><svg viewBox="0 0 24 24" class="ico"><path d="M3 10.5 12 3l9 7.5V21a1 1 0 0 1-1 1h-5v-7H9v7H4a1 1 0 0 1-1-1v-10.5z" fill="currentColor"/></svg><span data-i18n="home">Home</span></button>
    <button data-nav="community" class="tabbtn"><svg viewBox="0 0 24 24" class="ico"><path d="M4 4h16a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2H8l-4 3V6a2 2 0 0 1 2-2z" fill="currentColor"/></svg><span data-i18n="chat">Community</span></button>
    <button data-nav="friends" class="tabbtn"><svg viewBox="0 0 24 24" class="ico"><path d="M12 12a4 4 0 1 0-4-4 4 4 0 0 0 4 4zm0 2c-3.33 0-10 1.67-10 5v3h20v-3c0-3.33-6.67-5-10-5z" fill="currentColor"/></svg><span data-i18n="friends">Friends</span></button>
  </nav>

  <footer class="legal">
    <small>Â© <span id="year"></span> ReHabit. <span data-i18n="footer">For support onlyâ€”does not replace professional treatment.</span></small>
  </footer>

  <script src="app.js"></script>
</body>
</html>
